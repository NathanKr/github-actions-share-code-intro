<h1>Project Name</h1>
....



<h2>Project Description</h2>
....

<h2>My Motivation</h2>
i have a monorepo for post2video. i have there two services : web server (next.js) and bullmq worker. Each has its own github actions workflow but 90% of workflow code is the same so how to share code ?

<h2>Installation</h2>
....


<h2>Usage</h2>
....


<h2>Technologies Used</h2>
<ul>
    <li>github actions</li>
</ul>


<h2>Design options</h2>
<ul>
    <li>`workflow_call` for Reusable Workflows</li>
    <li>Composite Actions</li>
    <li>Docker Actions</li>
    <li>Shell Scripts</li>
</ul>

for monprepo workflow_call is the best choice

<h2>workflow_call basics</h2>

<h3>Players</h3>
<ul>
  <li><strong>Caller:</strong> The workflow that triggers and passes inputs to the reusable workflow.</li>
  <li><strong>Callee:</strong> The reusable workflow that contains shared logic and executes when called.</li>
</ul>



<h3>Caller vs Callee Rules</h3>
<ul>
 <li>
        <strong>For the Calling Workflow (the "caller" workflow, here, <code>main-caller.yml</code>):</strong>
        <ul>
            <li>You <strong>can</strong> have any standard event triggers (<code>on: push</code>, <code>on: pull_request</code>, <code>on: schedule</code>, etc.) or <code>on: workflow_dispatch</code>.</li>
            <li>This workflow then uses the <code>uses:</code> keyword to call the reusable workflow.</li>
        </ul>
    </li>
    <li>
        <strong>For the Reusable Workflow (the "callee" workflow, here, <code>simple-reusable.yml</code>):</strong>
        <ul>
            <li>You <strong>cannot</strong> have standard event triggers like <code>on: push</code>, <code>on: pull_request</code>, <code>on: schedule</code>, etc.</li>
            <li>You <strong>must</strong> have <code>on: workflow_call</code> (and optionally <code>on: workflow_dispatch</code> for manual testing).</li>
        </ul>
    </li>
</ul>

<h3>Workflow Call Elements</h3>
<ul>
    <li><strong>Inputs:</strong> Variables defined in a reusable workflow that allow the calling workflow to pass data into it.</li>
    <li><strong>Outputs:</strong> Data generated by a reusable workflow that can be passed back and used by the calling workflow.</li>
    <li><strong>Secrets:</strong> Sensitive information (like API tokens) that can be securely passed from the calling workflow to the reusable workflow.</li>
    <li><strong>Permissions:</strong> Explicit grants of access rights (e.g., to read repository contents or write to packages) required by a workflow to perform its tasks.</li>
</ul>

<h2>Code Structure</h2>

This example demonstrates a fundamental concept in GitHub Actions: reusable workflows. This pattern promotes modularity, reduces duplication, and makes your CI/CD pipelines more manageable, especially for larger projects.

<h3>Caller workflow</h3>
This is the main workflow that initiates or "calls" another workflow. It's often where you define the triggers and top-level jobs for your CI/CD process.

```yml
name: Main Caller Workflow # The name of this workflow, displayed in GitHub's UI.

on:
  push: # This workflow will trigger automatically when code is pushed to the 'main' branch.
    branches:
      - main
  workflow_dispatch: # Allows you to manually trigger this workflow from the GitHub UI.

jobs:
  call_reusable_workflow: # Defines a job within this workflow.
    uses: ./.github/workflows/simple-reusable.yml # This is the crucial part. It calls the reusable workflow located at the specified path.
    with: # This section allows you to pass inputs to the reusable workflow.
      message: "Hello from the main workflow!" # Here, we're passing a string value to the 'message' input of the callee workflow.
```


<h3>Callee workflow</h3>
This is the workflow designed to be called and reused by other workflows. It encapsulates a specific set of actions or logic that can be consistently applied across different parts of your CI/CD pipeline.

```yml
# name: Simple Reusable Workflow # The name of this reusable workflow.

on:
  workflow_call: # This is the key trigger for a reusable workflow. It means this workflow can only be triggered by another workflow.
    inputs: # Defines the inputs that this reusable workflow expects from its caller.
      message: # The name of the input. This must match the key used in the 'with' section of the caller.
        required: true # Specifies that this input must always be provided by the caller.
        type: string # Defines the data type of the input.
        description: "A message passed from the caller workflow." # A helpful description for anyone using this reusable workflow.

jobs:
  reusable_job: # Defines a job within this reusable workflow.
    runs-on: ubuntu-latest # Specifies the operating system environment for this job.
    steps: # A sequence of tasks to be executed within the job.
      - name: Print the message # A descriptive name for this step.
        run: | # Executes a shell command.
          echo "Message from caller: ${{ inputs.message }}" # Accesses the 'message' input passed from the caller using the `inputs` context.
```

<h2>Demo</h2>
push to main is presented in the following image

<img src='./figs/push-to-main.png'/>


<h2>Points of Interest</h2>
<ul>
    <li>...</li>
   
</ul>

<h2>References</h2>
<ul>
    <li><a href='https://docs.github.com/en/actions/sharing-automations/reusing-workflows'>official docs</a></li>
        <li><a href='https://www.youtube.com/watch?v=x239z6DdE0A'> Introduction to GitHub Actions: Learn Workflows with Examples </a></li>
</ul>

